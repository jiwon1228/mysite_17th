<html layout:decorate="~{layout}">
<div layout:fragment="content">
	<div class="container">
		<div class="jumbotron">
			<div class="display-4">
				<small><span class="small">질문 제목 : </span>[[${question.subject}]]</small>
			</div>
		</div>

		<div class="card bg-warning">
			<div class="card-body ">
				<h5 class="card-title text-white"><span class="small">질문내용  : </span>[[${question.content}]]
							<span class="badge badge-pill badge-secondary float-right" th:text="${#temporals.format(question.createDate, 'yyyy-MM-dd HH:MM')}"></span>
							<span class="badge badge-pill badge-secondary float-right mr-2" th:if="${question.author != null}">[[${question.author.username}]]</span>
						</h5>
			</div>
		</div>
		
		<!-- 질문 수정 버튼 -->
		<a th:href="@{|/question/modify/${question.id}|}" class="btn btn-success mt-2" 
		   sec:authorize="isAuthenticated()" 
		   th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}">
		   질문 수정
		</a>

		<!-- 질문 삭제 버튼 -->
		<a href="javascript:void(0);" th:data-uri="@{|/question/delete/${question.id}|}" class="delete btn btn-danger mt-2" 
		   sec:authorize="isAuthenticated()" 
		   th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}">
		   질문 삭제
		</a>

		<h4 class="my-5 border-bottom py-2"
			th:text="|${#lists.size(question.answerList)}개의 답변이 있습니다.|"></h4>

		<div>
			<ul class="list-unstyled">
				<div class="card bg-light my-3"
					th:each="answer : ${question.answerList}">
					<div class="card-body">
						<li>[[${answer.content}]]</li>
		
						<!-- 날짜를 출력하는 배찌  -->
						<div class="d-flex justify-content-end">
							<span class="badge badge-pill badge-success mr-2" th:if="${answer.author != null}">[[${answer.author.username}]]</span>
							<span class="badge badge-pill badge-secondary"
								th:text="${#temporals.format(answer.createDate, 'yyyy-MM-dd HH:mm')}"></span>
							<!-- 답변을 수정하는 버튼 -->
						</div>
							<div>
					<!-- 답변을 수정하는 버튼 -->
								<div>
									<a th:href="@{|/answer/modify/${answer.id}|}" class="btn btn-success" sec:authorize="isAuthenticated()" th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}" th:text="답변수정"></a>

									<a href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}" class="btn btn-danger delete" sec:authorize="isAuthenticated()" th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}" th:text="답변삭제"></a>

								</div>
						</div>
					</div>
				</div>
			</ul>
		</div>
		
		<!-- 답변 작성 -->
		<form th:action="@{|/answer/create/${question.id}|}" method="post" th:object="${answerForm}">
			<!-- 유효성검증 error시 출력되는 구문 -->
			<div th:replace="~{form_errors :: formErrorsFragment}"></div>
	
			<div class="form-group">
				<!-- 답변 기능의 content 항목도 th:field 속성을 사용하겠다는 의미로 th:field*{content}를 넣는다. -->
				<!-- isAnonymous() 로그인이 안된 상태 isAuthenticated() 로그인이 된 상태 -->
				<textarea sec:authorize="isAnonymous()" th:field="*{content}" class="form-control" name="content" id="content" cols="30"
					rows="10" disabled placeholder="로그인 한 상태에서 답변 작성 가능합니다."></textarea>
				<textarea sec:authorize="isAuthenticated()" th:field="*{content}" class="form-control" name="content" id="content" cols="30"
					rows="10"></textarea>
			</div>
			<input class="btn btn-warning p-2" type="submit" value="답변 등록하기" />
		</form>
	</div>
</div>

<script layout:fragment="script" type="text/javascript">
	const delete_elements = document.getElementsByClassName("delete");
	Array.from(delete_elements).forEach(function(element){
		element.addEventListener("click", function() {
			if (confirm("정말로 삭제하시겠습니까?")) {
				location.href = this.dataset.uri;
			}
		});
	});
</script>
</html>
